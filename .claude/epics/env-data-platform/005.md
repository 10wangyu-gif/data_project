---
name: 数据目录系统
status: open
created: 2025-09-16T08:20:41Z
updated: 2025-09-16T08:20:41Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: true
conflicts_with: []
---

# 数据目录系统

## 概述
构建企业级数据目录系统，提供完整的元数据管理、数据分类标签和智能搜索查询功能，帮助用户快速发现和理解数据资产。

## 核心功能

### 1. 元数据管理
- **自动元数据采集**
  - 数据库表结构自动发现
  - 文件系统元数据提取
  - API接口元数据解析
  - 数据血缘关系追踪

- **元数据编辑和丰富**
  - 业务含义描述编辑
  - 数据质量规则定义
  - 敏感数据标记
  - 版本历史管理

### 2. 分类标签系统
- **层次化分类体系**
  - 业务域分类（财务、人力、运营等）
  - 技术分类（结构化、半结构化等）
  - 敏感度分类（公开、内部、机密等）
  - 自定义标签扩展

- **智能标签推荐**
  - 基于内容的自动标签
  - 基于使用模式的推荐
  - 协同标签建议
  - 标签质量评估

### 3. 搜索查询引擎
- **Elasticsearch全文搜索**
  - 多字段联合搜索
  - 模糊匹配和精确查找
  - 搜索结果高亮显示
  - 搜索历史记录

- **高级查询功能**
  - 多维度过滤条件
  - 范围查询和聚合统计
  - 相似数据推荐
  - 个性化搜索排序

## 技术架构

### 元数据模型
```java
// 数据资产基础信息
@Entity
@Table(name = "data_assets")
public class DataAsset {
    @Id
    private Long id;

    private String name;                // 资产名称
    private String description;         // 业务描述
    private DataAssetType type;         // 资产类型
    private String source;              // 数据源标识
    private String schemaName;          // 模式名称
    private String tableName;           // 表名
    private DataFormat format;          // 数据格式
    private Long recordCount;           // 记录数量
    private Long dataSize;              // 数据大小
    private Date lastUpdated;           // 最后更新时间

    @OneToMany(mappedBy = "dataAsset")
    private List<DataField> fields;     // 字段列表

    @ManyToMany
    private Set<DataTag> tags;          // 标签列表

    @OneToMany(mappedBy = "dataAsset")
    private List<DataLineage> lineages; // 血缘关系
}

// 数据字段信息
@Entity
@Table(name = "data_fields")
public class DataField {
    @Id
    private Long id;

    private String name;                // 字段名称
    private String description;         // 字段描述
    private DataType dataType;          // 数据类型
    private Integer length;             // 字段长度
    private Boolean nullable;           // 是否可空
    private Boolean primaryKey;         // 是否主键
    private String defaultValue;        // 默认值
    private String comment;             // 注释

    @ManyToOne
    private DataAsset dataAsset;        // 所属数据资产

    @ManyToMany
    private Set<DataTag> tags;          // 字段标签
}
```

### 搜索索引结构
```json
{
  "mappings": {
    "properties": {
      "assetId": { "type": "long" },
      "name": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart",
        "fields": {
          "keyword": { "type": "keyword" }
        }
      },
      "description": {
        "type": "text",
        "analyzer": "ik_max_word"
      },
      "type": { "type": "keyword" },
      "source": { "type": "keyword" },
      "tags": {
        "type": "nested",
        "properties": {
          "name": { "type": "keyword" },
          "category": { "type": "keyword" },
          "value": { "type": "keyword" }
        }
      },
      "fields": {
        "type": "nested",
        "properties": {
          "name": { "type": "text", "analyzer": "ik_max_word" },
          "description": { "type": "text", "analyzer": "ik_max_word" },
          "dataType": { "type": "keyword" },
          "tags": { "type": "keyword" }
        }
      },
      "businessDomain": { "type": "keyword" },
      "sensitivity": { "type": "keyword" },
      "qualityScore": { "type": "float" },
      "usage": {
        "properties": {
          "viewCount": { "type": "long" },
          "downloadCount": { "type": "long" },
          "lastAccessed": { "type": "date" }
        }
      },
      "createdAt": { "type": "date" },
      "updatedAt": { "type": "date" }
    }
  }
}
```

## 数据库设计

### 核心数据表
```sql
-- 数据资产表
CREATE TABLE data_assets (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(200) NOT NULL COMMENT '资产名称',
    description TEXT COMMENT '业务描述',
    type ENUM('TABLE', 'VIEW', 'FILE', 'API', 'STREAM') NOT NULL COMMENT '资产类型',
    source VARCHAR(100) NOT NULL COMMENT '数据源',
    schema_name VARCHAR(100) COMMENT '模式名称',
    table_name VARCHAR(100) COMMENT '表名',
    file_path VARCHAR(500) COMMENT '文件路径',
    format ENUM('CSV', 'JSON', 'PARQUET', 'EXCEL', 'XML') COMMENT '数据格式',
    record_count BIGINT DEFAULT 0 COMMENT '记录数',
    data_size BIGINT DEFAULT 0 COMMENT '数据大小(字节)',
    business_domain VARCHAR(50) COMMENT '业务域',
    sensitivity ENUM('PUBLIC', 'INTERNAL', 'CONFIDENTIAL', 'SECRET') DEFAULT 'INTERNAL',
    quality_score DECIMAL(3,2) DEFAULT 0.0 COMMENT '质量评分',
    owner_id BIGINT COMMENT '负责人ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_source (source),
    INDEX idx_type (type),
    INDEX idx_domain (business_domain),
    INDEX idx_updated (updated_at),
    FULLTEXT idx_search (name, description)
);

-- 数据字段表
CREATE TABLE data_fields (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    asset_id BIGINT NOT NULL,
    name VARCHAR(100) NOT NULL COMMENT '字段名称',
    description TEXT COMMENT '字段描述',
    data_type VARCHAR(50) NOT NULL COMMENT '数据类型',
    length INTEGER COMMENT '字段长度',
    nullable BOOLEAN DEFAULT TRUE COMMENT '是否可空',
    primary_key BOOLEAN DEFAULT FALSE COMMENT '是否主键',
    default_value VARCHAR(200) COMMENT '默认值',
    comment TEXT COMMENT '字段注释',
    business_name VARCHAR(200) COMMENT '业务名称',
    sample_values JSON COMMENT '示例数据',
    FOREIGN KEY (asset_id) REFERENCES data_assets(id) ON DELETE CASCADE,
    INDEX idx_asset_id (asset_id),
    INDEX idx_name (name),
    FULLTEXT idx_desc_search (description, business_name)
);

-- 数据标签表
CREATE TABLE data_tags (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL COMMENT '标签名称',
    category VARCHAR(50) NOT NULL COMMENT '标签类别',
    color VARCHAR(7) COMMENT '显示颜色',
    description TEXT COMMENT '标签描述',
    parent_id BIGINT COMMENT '父标签ID',
    sort_order INTEGER DEFAULT 0 COMMENT '排序序号',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES data_tags(id),
    UNIQUE KEY uk_name_category (name, category),
    INDEX idx_category (category),
    INDEX idx_parent (parent_id)
);

-- 资产标签关联表
CREATE TABLE asset_tags (
    asset_id BIGINT NOT NULL,
    tag_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by BIGINT COMMENT '创建人',
    PRIMARY KEY (asset_id, tag_id),
    FOREIGN KEY (asset_id) REFERENCES data_assets(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES data_tags(id) ON DELETE CASCADE
);

-- 数据血缘表
CREATE TABLE data_lineage (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    source_asset_id BIGINT NOT NULL COMMENT '源数据资产ID',
    target_asset_id BIGINT NOT NULL COMMENT '目标数据资产ID',
    lineage_type ENUM('DIRECT', 'TRANSFORM', 'AGGREGATE', 'JOIN') NOT NULL COMMENT '血缘类型',
    transform_logic TEXT COMMENT '转换逻辑',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (source_asset_id) REFERENCES data_assets(id),
    FOREIGN KEY (target_asset_id) REFERENCES data_assets(id),
    INDEX idx_source (source_asset_id),
    INDEX idx_target (target_asset_id),
    UNIQUE KEY uk_lineage (source_asset_id, target_asset_id, lineage_type)
);
```

## API接口设计

### 数据资产管理
```java
@RestController
@RequestMapping("/api/catalog/assets")
public class DataAssetController {

    // 获取资产列表
    @GetMapping
    public ResponseEntity<PageResult<DataAssetVO>> getAssets(
        @RequestParam(defaultValue = "1") int page,
        @RequestParam(defaultValue = "20") int size,
        @RequestParam(required = false) String keyword,
        @RequestParam(required = false) String type,
        @RequestParam(required = false) String domain,
        @RequestParam(required = false) List<String> tags);

    // 获取资产详情
    @GetMapping("/{assetId}")
    public ResponseEntity<DataAssetDetailVO> getAsset(@PathVariable Long assetId);

    // 创建资产
    @PostMapping
    public ResponseEntity<DataAssetVO> createAsset(@RequestBody CreateDataAssetRequest request);

    // 更新资产信息
    @PutMapping("/{assetId}")
    public ResponseEntity<DataAssetVO> updateAsset(
        @PathVariable Long assetId,
        @RequestBody UpdateDataAssetRequest request);

    // 删除资产
    @DeleteMapping("/{assetId}")
    public ResponseEntity<Void> deleteAsset(@PathVariable Long assetId);

    // 获取资产字段
    @GetMapping("/{assetId}/fields")
    public ResponseEntity<List<DataFieldVO>> getAssetFields(@PathVariable Long assetId);

    // 获取资产血缘
    @GetMapping("/{assetId}/lineage")
    public ResponseEntity<DataLineageVO> getAssetLineage(
        @PathVariable Long assetId,
        @RequestParam(defaultValue = "3") int depth);
}
```

### 搜索服务接口
```java
@RestController
@RequestMapping("/api/catalog/search")
public class CatalogSearchController {

    // 全文搜索
    @GetMapping
    public ResponseEntity<SearchResultVO> search(
        @RequestParam String keyword,
        @RequestParam(defaultValue = "1") int page,
        @RequestParam(defaultValue = "20") int size,
        @RequestParam(required = false) List<String> types,
        @RequestParam(required = false) List<String> domains,
        @RequestParam(required = false) List<String> tags);

    // 高级搜索
    @PostMapping("/advanced")
    public ResponseEntity<SearchResultVO> advancedSearch(@RequestBody AdvancedSearchRequest request);

    // 搜索建议
    @GetMapping("/suggest")
    public ResponseEntity<List<SearchSuggestionVO>> searchSuggestions(@RequestParam String query);

    // 相似资产推荐
    @GetMapping("/similar/{assetId}")
    public ResponseEntity<List<DataAssetVO>> getSimilarAssets(@PathVariable Long assetId);

    // 热门搜索
    @GetMapping("/trending")
    public ResponseEntity<List<TrendingSearchVO>> getTrendingSearches();
}
```

### 标签管理接口
```java
@RestController
@RequestMapping("/api/catalog/tags")
public class DataTagController {

    // 获取标签树
    @GetMapping("/tree")
    public ResponseEntity<List<TagTreeVO>> getTagTree();

    // 获取标签列表
    @GetMapping
    public ResponseEntity<PageResult<DataTagVO>> getTags(
        @RequestParam(defaultValue = "1") int page,
        @RequestParam(defaultValue = "50") int size,
        @RequestParam(required = false) String category);

    // 创建标签
    @PostMapping
    public ResponseEntity<DataTagVO> createTag(@RequestBody CreateDataTagRequest request);

    // 更新标签
    @PutMapping("/{tagId}")
    public ResponseEntity<DataTagVO> updateTag(
        @PathVariable Long tagId,
        @RequestBody UpdateDataTagRequest request);

    // 删除标签
    @DeleteMapping("/{tagId}")
    public ResponseEntity<Void> deleteTag(@PathVariable Long tagId);

    // 为资产添加标签
    @PostMapping("/assets/{assetId}")
    public ResponseEntity<Void> addAssetTags(
        @PathVariable Long assetId,
        @RequestBody List<Long> tagIds);

    // 移除资产标签
    @DeleteMapping("/assets/{assetId}")
    public ResponseEntity<Void> removeAssetTags(
        @PathVariable Long assetId,
        @RequestBody List<Long> tagIds);
}
```

## 前端页面设计

### 数据目录主页
```vue
<template>
  <div class="catalog-home">
    <!-- 搜索栏 -->
    <div class="search-section">
      <el-input
        v-model="searchKeyword"
        placeholder="搜索数据资产..."
        @keyup.enter="performSearch"
        size="large"
        class="search-input"
      >
        <template #prefix>
          <el-icon><Search /></el-icon>
        </template>
        <template #append>
          <el-button type="primary" @click="performSearch">搜索</el-button>
        </template>
      </el-input>

      <!-- 快捷过滤 -->
      <div class="quick-filters">
        <el-tag
          v-for="filter in quickFilters"
          :key="filter.key"
          :class="{ active: selectedFilters.includes(filter.key) }"
          @click="toggleFilter(filter.key)"
        >
          {{ filter.label }}
        </el-tag>
      </div>
    </div>

    <!-- 内容区域 -->
    <div class="main-content">
      <!-- 左侧分类导航 -->
      <div class="category-nav">
        <CategoryTree
          :categories="categories"
          :selected="selectedCategory"
          @select="onCategorySelect"
        />
      </div>

      <!-- 中间资产列表 -->
      <div class="asset-list">
        <div class="list-header">
          <span class="result-count">找到 {{ totalCount }} 个数据资产</span>
          <div class="list-controls">
            <el-select v-model="sortBy" placeholder="排序方式">
              <el-option label="相关度" value="relevance" />
              <el-option label="最近更新" value="updated" />
              <el-option label="使用频率" value="usage" />
              <el-option label="数据质量" value="quality" />
            </el-select>
            <el-button-group class="view-mode">
              <el-button :type="viewMode === 'list' ? 'primary' : ''" @click="viewMode = 'list'">
                <el-icon><List /></el-icon>
              </el-button>
              <el-button :type="viewMode === 'card' ? 'primary' : ''" @click="viewMode = 'card'">
                <el-icon><Grid /></el-icon>
              </el-button>
            </el-button-group>
          </div>
        </div>

        <!-- 资产列表 -->
        <AssetList
          :assets="assets"
          :view-mode="viewMode"
          :loading="loading"
          @asset-click="onAssetClick"
          @tag-click="onTagClick"
        />

        <!-- 分页 -->
        <el-pagination
          v-model:current-page="currentPage"
          :total="totalCount"
          :page-size="pageSize"
          layout="prev, pager, next, sizes, total"
          @current-change="onPageChange"
          @size-change="onSizeChange"
        />
      </div>

      <!-- 右侧信息面板 -->
      <div class="info-panel">
        <StatisticsPanel :stats="catalogStats" />
        <TrendingPanel :trending="trendingAssets" />
        <RecentPanel :recent="recentAssets" />
      </div>
    </div>
  </div>
</template>
```

### 资产详情页面
```vue
<template>
  <div class="asset-detail">
    <!-- 头部信息 -->
    <div class="asset-header">
      <div class="basic-info">
        <h1 class="asset-title">{{ asset.name }}</h1>
        <div class="asset-meta">
          <el-tag :type="getTypeColor(asset.type)">{{ asset.type }}</el-tag>
          <span class="source">{{ asset.source }}</span>
          <span class="updated">更新于 {{ formatDate(asset.updatedAt) }}</span>
        </div>
        <div class="asset-tags">
          <el-tag
            v-for="tag in asset.tags"
            :key="tag.id"
            :color="tag.color"
            class="asset-tag"
          >
            {{ tag.name }}
          </el-tag>
        </div>
      </div>

      <div class="actions">
        <el-button type="primary" @click="previewData">预览数据</el-button>
        <el-button @click="downloadSample">下载样本</el-button>
        <el-button @click="createQuery">创建查询</el-button>
        <el-dropdown @command="handleCommand">
          <el-button>
            更多 <el-icon><ArrowDown /></el-icon>
          </el-button>
          <template #dropdown>
            <el-dropdown-menu>
              <el-dropdown-item command="edit">编辑信息</el-dropdown-item>
              <el-dropdown-item command="lineage">查看血缘</el-dropdown-item>
              <el-dropdown-item command="quality">质量报告</el-dropdown-item>
              <el-dropdown-item command="export">导出元数据</el-dropdown-item>
            </el-dropdown-menu>
          </template>
        </el-dropdown>
      </div>
    </div>

    <!-- 详细信息标签页 -->
    <el-tabs v-model="activeTab" class="asset-tabs">
      <!-- 基本信息 -->
      <el-tab-pane label="基本信息" name="basic">
        <BasicInfoPanel :asset="asset" />
      </el-tab-pane>

      <!-- 字段结构 -->
      <el-tab-pane label="字段结构" name="schema">
        <SchemaPanel :fields="asset.fields" />
      </el-tab-pane>

      <!-- 数据预览 -->
      <el-tab-pane label="数据预览" name="preview">
        <DataPreviewPanel :asset-id="asset.id" />
      </el-tab-pane>

      <!-- 血缘关系 -->
      <el-tab-pane label="血缘关系" name="lineage">
        <LineagePanel :asset-id="asset.id" />
      </el-tab-pane>

      <!-- 使用统计 -->
      <el-tab-pane label="使用统计" name="usage">
        <UsagePanel :asset-id="asset.id" />
      </el-tab-pane>

      <!-- 质量报告 -->
      <el-tab-pane label="质量报告" name="quality">
        <QualityPanel :asset-id="asset.id" />
      </el-tab-pane>
    </el-tabs>
  </div>
</template>
```

## 实现计划

### Phase 1: 核心框架 (2天)
- 搭建Spring Boot后端框架
- 设计数据模型和数据库表
- 实现基础的CRUD接口

### Phase 2: 搜索引擎 (2天)
- 集成Elasticsearch搜索服务
- 实现索引构建和数据同步
- 开发全文搜索和过滤功能

### Phase 3: 前端界面 (2天)
- 开发Vue3前端应用
- 实现搜索界面和资产列表
- 开发资产详情页面

### Phase 4: 高级功能 (1天)
- 实现标签管理和分类体系
- 开发血缘关系追踪
- 添加数据质量评估

## 验收标准

1. **功能完整性**
   - 支持多种数据源的元数据采集
   - 标签分类系统完整可用
   - 搜索功能准确高效

2. **性能要求**
   - 搜索响应时间 < 500ms
   - 支持万级数据资产管理
   - 页面加载时间 < 2s

3. **用户体验**
   - 搜索结果精准相关
   - 界面操作直观友好
   - 信息展示清晰完整

4. **系统稳定性**
   - 数据索引实时同步
   - 系统高可用性
   - 扩展性良好