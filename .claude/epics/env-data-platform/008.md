---
name: 前端界面集成
status: open
created: 2025-09-16T08:20:41Z
updated: 2025-09-16T08:20:41Z
github: [Will be updated when synced to GitHub]
depends_on: [002, 003, 004, 005, 006]
parallel: true
conflicts_with: [009]
---

# Task 008: 前端界面集成

## 概述
基于Doubao设计系统实现统一的前端界面，整合所有后端服务，提供完整的用户体验。

## 核心功能

### 1. 主要页面架构
```typescript
// src/pages/index.tsx
export const PageRoutes = {
  // 数据概览
  dashboard: '/dashboard',

  // 实时监控
  realtime: '/realtime',
  monitoring: '/monitoring',

  // 数据管理
  sensors: '/sensors',
  data: '/data',
  quality: '/quality',

  // 分析预测
  analysis: '/analysis',
  prediction: '/prediction',
  reports: '/reports',

  // 告警管理
  alerts: '/alerts',
  rules: '/rules',

  // 系统设置
  settings: '/settings',
  users: '/users',
  logs: '/logs'
};
```

### 2. 统一状态管理
```typescript
// src/store/index.ts
import { configureStore } from '@reduxjs/toolkit';
import { createApi } from '@reduxjs/toolkit/query/react';

// API定义
export const envPlatformApi = createApi({
  reducerPath: 'envPlatformApi',
  baseQuery: fetchBaseQuery({
    baseUrl: '/api/v1/',
    prepareHeaders: (headers, { getState }) => {
      const token = (getState() as RootState).auth.token;
      if (token) {
        headers.set('authorization', `Bearer ${token}`);
      }
      return headers;
    },
  }),
  tagTypes: ['Sensor', 'Data', 'Alert', 'User'],
  endpoints: (builder) => ({
    // 传感器管理
    getSensors: builder.query<SensorResponse[], void>({
      query: () => 'sensors',
      providesTags: ['Sensor'],
    }),
    createSensor: builder.mutation<SensorResponse, CreateSensorRequest>({
      query: (sensor) => ({
        url: 'sensors',
        method: 'POST',
        body: sensor,
      }),
      invalidatesTags: ['Sensor'],
    }),

    // 实时数据
    getRealtimeData: builder.query<RealtimeDataResponse, string>({
      query: (sensorId) => `sensors/${sensorId}/realtime`,
      providesTags: ['Data'],
    }),

    // 告警管理
    getAlerts: builder.query<AlertResponse[], AlertFilters>({
      query: (filters) => ({
        url: 'alerts',
        params: filters,
      }),
      providesTags: ['Alert'],
    }),

    // 数据分析
    getAnalysisReport: builder.query<AnalysisReport, AnalysisRequest>({
      query: (request) => ({
        url: 'analysis/report',
        method: 'POST',
        body: request,
      }),
    }),
  }),
});

// Store配置
export const store = configureStore({
  reducer: {
    auth: authSlice.reducer,
    ui: uiSlice.reducer,
    envPlatformApi: envPlatformApi.reducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(envPlatformApi.middleware),
});
```

### 3. Doubao设计系统集成
```typescript
// src/components/DoubaoTheme.tsx
import { ConfigProvider, theme } from '@douyinfe/semi-ui';

export const DoubaoTheme = {
  light: {
    colors: {
      primary: '#3370ff',
      secondary: '#36ad6a',
      warning: '#ff7d00',
      danger: '#f53f3f',
      success: '#00b42a',

      // 环境监测主题色
      air: '#1890ff',      // 空气质量 - 蓝色
      water: '#52c41a',    // 水质 - 绿色
      soil: '#fa8c16',     // 土壤 - 橙色
      noise: '#722ed1',    // 噪声 - 紫色
    },
    layout: {
      sidebarWidth: 240,
      headerHeight: 64,
      footerHeight: 48,
    },
  },
  dark: {
    colors: {
      primary: '#4080ff',
      // ... 暗色主题配置
    },
  },
};

export const DoubaoConfigProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [isDark, setIsDark] = useState(false);

  return (
    <ConfigProvider
      theme={isDark ? theme.dark : theme.light}
      getPopupContainer={() => document.body}
    >
      <div className={`app-theme ${isDark ? 'dark' : 'light'}`}>
        {children}
      </div>
    </ConfigProvider>
  );
};
```

## 核心页面实现

### 1. 数据概览仪表板
```typescript
// src/pages/Dashboard.tsx
import { Card, Row, Col, Statistic, Progress, Chart } from '@douyinfe/semi-ui';
import { useGetDashboardDataQuery } from '../store/api';

export const Dashboard: React.FC = () => {
  const { data: dashboardData, isLoading } = useGetDashboardDataQuery();

  return (
    <div className="dashboard-container">
      {/* 关键指标卡片 */}
      <Row gutter={16} className="stats-row">
        <Col span={6}>
          <Card>
            <Statistic
              title="在线传感器"
              value={dashboardData?.onlineSensors || 0}
              suffix={`/ ${dashboardData?.totalSensors || 0}`}
              valueStyle={{ color: '#3370ff' }}
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="数据质量"
              value={dashboardData?.dataQuality || 0}
              suffix="%"
              valueStyle={{
                color: dashboardData?.dataQuality > 90 ? '#00b42a' : '#ff7d00'
              }}
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="活跃告警"
              value={dashboardData?.activeAlerts || 0}
              valueStyle={{ color: '#f53f3f' }}
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="今日数据量"
              value={dashboardData?.todayDataCount || 0}
              formatter={(value) => `${(value / 10000).toFixed(1)}万`}
            />
          </Card>
        </Col>
      </Row>

      {/* 环境质量趋势图 */}
      <Row gutter={16} className="charts-row">
        <Col span={12}>
          <Card title="环境质量趋势" headerExtraContent={<TimeRangeSelector />}>
            <EnvironmentTrendChart data={dashboardData?.trends} />
          </Card>
        </Col>
        <Col span={12}>
          <Card title="传感器分布">
            <SensorDistributionMap sensors={dashboardData?.sensors} />
          </Card>
        </Col>
      </Row>

      {/* 最新告警和数据质量 */}
      <Row gutter={16}>
        <Col span={12}>
          <Card title="最新告警" headerExtraContent={<Button>查看全部</Button>}>
            <RecentAlertsList alerts={dashboardData?.recentAlerts} />
          </Card>
        </Col>
        <Col span={12}>
          <Card title="数据质量报告">
            <DataQualityReport quality={dashboardData?.qualityReport} />
          </Card>
        </Col>
      </Row>
    </div>
  );
};
```

### 2. 实时监控页面
```typescript
// src/pages/RealtimeMonitoring.tsx
import { useWebSocket } from '../hooks/useWebSocket';
import { RealTimeChart, SensorGrid, AlertPanel } from '../components';

export const RealtimeMonitoring: React.FC = () => {
  const { data: realtimeData, connectionStatus } = useWebSocket('/ws/realtime');
  const [selectedSensor, setSelectedSensor] = useState<string | null>(null);

  return (
    <Layout className="realtime-monitoring">
      <Sider width={300} className="sensor-sidebar">
        <div className="connection-status">
          <Badge
            dot
            status={connectionStatus === 'connected' ? 'success' : 'error'}
          >
            实时连接状态
          </Badge>
        </div>

        <SensorGrid
          sensors={realtimeData?.sensors}
          selectedSensor={selectedSensor}
          onSensorSelect={setSelectedSensor}
        />
      </Sider>

      <Content className="monitoring-content">
        <div className="monitoring-header">
          <Title level={3}>实时监控</Title>
          <Space>
            <Button icon={<IconRefresh />}>手动刷新</Button>
            <Button icon={<IconDownload />}>导出数据</Button>
          </Space>
        </div>

        {selectedSensor ? (
          <SensorDetailView
            sensorId={selectedSensor}
            realtimeData={realtimeData?.sensorData[selectedSensor]}
          />
        ) : (
          <OverviewMode sensors={realtimeData?.sensors} />
        )}

        <AlertPanel alerts={realtimeData?.activeAlerts} />
      </Content>
    </Layout>
  );
};
```

### 3. 数据分析页面
```typescript
// src/pages/DataAnalysis.tsx
import { DatePicker, Select, Button, Table, Modal } from '@douyinfe/semi-ui';
import { AnalysisChart, PredictionPanel, ReportGenerator } from '../components';

export const DataAnalysis: React.FC = () => {
  const [analysisConfig, setAnalysisConfig] = useState<AnalysisConfig>({
    timeRange: [dayjs().subtract(30, 'day'), dayjs()],
    sensors: [],
    metrics: ['aqi', 'pm25', 'temperature'],
    analysisType: 'trend',
  });

  const { data: analysisResult, isFetching } = useGetAnalysisQuery(analysisConfig);
  const [generateReport] = useGenerateReportMutation();

  return (
    <div className="data-analysis">
      <Card className="analysis-config">
        <Title level={4}>分析配置</Title>
        <Form onSubmit={handleAnalysis}>
          <Row gutter={16}>
            <Col span={8}>
              <Form.DatePicker
                field="timeRange"
                label="时间范围"
                type="dateTimeRange"
                value={analysisConfig.timeRange}
                onChange={(value) => setAnalysisConfig({
                  ...analysisConfig,
                  timeRange: value
                })}
              />
            </Col>
            <Col span={8}>
              <Form.Select
                field="sensors"
                label="传感器"
                multiple
                placeholder="选择传感器"
                optionList={sensorOptions}
              />
            </Col>
            <Col span={8}>
              <Form.Select
                field="analysisType"
                label="分析类型"
                optionList={[
                  { value: 'trend', label: '趋势分析' },
                  { value: 'correlation', label: '关联分析' },
                  { value: 'prediction', label: '预测分析' },
                  { value: 'anomaly', label: '异常检测' }
                ]}
              />
            </Col>
          </Row>
          <Button
            type="primary"
            htmlType="submit"
            loading={isFetching}
            icon={<IconSearch />}
          >
            开始分析
          </Button>
        </Form>
      </Card>

      {analysisResult && (
        <>
          <Row gutter={16}>
            <Col span={16}>
              <Card title="分析结果">
                <AnalysisChart
                  data={analysisResult.chartData}
                  type={analysisConfig.analysisType}
                />
              </Card>
            </Col>
            <Col span={8}>
              <Card title="统计摘要">
                <AnalysisSummary summary={analysisResult.summary} />
              </Card>
            </Col>
          </Row>

          {analysisConfig.analysisType === 'prediction' && (
            <Card title="预测结果">
              <PredictionPanel predictions={analysisResult.predictions} />
            </Card>
          )}

          <Card title="详细数据">
            <Button
              onClick={() => generateReport(analysisResult)}
              icon={<IconDownload />}
            >
              生成报告
            </Button>
            <Table
              dataSource={analysisResult.tableData}
              columns={getAnalysisTableColumns()}
              pagination={{ pageSize: 20 }}
            />
          </Card>
        </>
      )}
    </div>
  );
};
```

### 4. 移动端适配
```typescript
// src/components/MobileLayout.tsx
import { useMediaQuery } from '../hooks/useMediaQuery';

export const ResponsiveLayout: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const isMobile = useMediaQuery('(max-width: 768px)');
  const isTablet = useMediaQuery('(max-width: 1024px)');

  if (isMobile) {
    return <MobileLayout>{children}</MobileLayout>;
  }

  if (isTablet) {
    return <TabletLayout>{children}</TabletLayout>;
  }

  return <DesktopLayout>{children}</DesktopLayout>;
};

const MobileLayout: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <div className="mobile-layout">
      <MobileHeader />
      <main className="mobile-content">
        {children}
      </main>
      <MobileBottomNav />
    </div>
  );
};
```

## 组件库扩展

### 1. 环境监测专用组件
```typescript
// src/components/environmental/index.ts
export { AirQualityCard } from './AirQualityCard';
export { WaterQualityPanel } from './WaterQualityPanel';
export { NoiseLevel } from './NoiseLevel';
export { SoilCondition } from './SoilCondition';
export { WeatherWidget } from './WeatherWidget';
export { PollutionHeatmap } from './PollutionHeatmap';

// src/components/environmental/AirQualityCard.tsx
export const AirQualityCard: React.FC<{
  data: AirQualityData;
  showTrend?: boolean;
}> = ({ data, showTrend = true }) => {
  const getAQILevel = (aqi: number) => {
    if (aqi <= 50) return { level: '优', color: '#00b42a' };
    if (aqi <= 100) return { level: '良', color: '#52c41a' };
    if (aqi <= 150) return { level: '轻度污染', color: '#fa8c16' };
    if (aqi <= 200) return { level: '中度污染', color: '#ff7d00' };
    if (aqi <= 300) return { level: '重度污染', color: '#f53f3f' };
    return { level: '严重污染', color: '#a61e1e' };
  };

  const aqiInfo = getAQILevel(data.aqi);

  return (
    <Card className="air-quality-card">
      <div className="aqi-header">
        <div className="aqi-value" style={{ color: aqiInfo.color }}>
          {data.aqi}
        </div>
        <div className="aqi-level" style={{ color: aqiInfo.color }}>
          {aqiInfo.level}
        </div>
      </div>

      <Descriptions size="small">
        <Descriptions.Item label="PM2.5">{data.pm25} μg/m³</Descriptions.Item>
        <Descriptions.Item label="PM10">{data.pm10} μg/m³</Descriptions.Item>
        <Descriptions.Item label="SO2">{data.so2} μg/m³</Descriptions.Item>
        <Descriptions.Item label="NO2">{data.no2} μg/m³</Descriptions.Item>
        <Descriptions.Item label="O3">{data.o3} μg/m³</Descriptions.Item>
        <Descriptions.Item label="CO">{data.co} mg/m³</Descriptions.Item>
      </Descriptions>

      {showTrend && (
        <div className="aqi-trend">
          <MiniChart data={data.trend} />
        </div>
      )}
    </Card>
  );
};
```

### 2. 数据可视化组件
```typescript
// src/components/charts/EnvironmentChart.tsx
import { Line, Area, Column } from '@ant-design/plots';

export const EnvironmentChart: React.FC<{
  data: ChartData[];
  type: 'line' | 'area' | 'column';
  metric: string;
}> = ({ data, type, metric }) => {
  const config = {
    data,
    xField: 'time',
    yField: 'value',
    seriesField: 'sensor',
    smooth: true,
    animation: {
      appear: {
        animation: 'path-in',
        duration: 1000,
      },
    },
    point: {
      size: 3,
      shape: 'circle',
    },
    tooltip: {
      formatter: (datum: any) => ({
        name: datum.sensor,
        value: `${datum.value} ${getMetricUnit(metric)}`,
      }),
    },
  };

  switch (type) {
    case 'area':
      return <Area {...config} />;
    case 'column':
      return <Column {...config} />;
    default:
      return <Line {...config} />;
  }
};
```

## 国产化适配

### 1. 信创浏览器兼容
```typescript
// src/utils/browser-compatibility.ts
export const BrowserCompatibility = {
  // 检测信创浏览器
  isXinChuangBrowser(): boolean {
    const userAgent = navigator.userAgent.toLowerCase();
    return userAgent.includes('kylin') ||
           userAgent.includes('uos') ||
           userAgent.includes('neokylin');
  },

  // 适配特殊API
  adaptAPIs() {
    if (this.isXinChuangBrowser()) {
      // 适配本地存储
      this.adaptLocalStorage();
      // 适配WebSocket
      this.adaptWebSocket();
      // 适配Fetch API
      this.adaptFetch();
    }
  },

  adaptLocalStorage() {
    // 信创环境localStorage兼容性处理
    if (!window.localStorage) {
      window.localStorage = {
        getItem: (key) => window.name[key] || null,
        setItem: (key, value) => { window.name[key] = value; },
        removeItem: (key) => { delete window.name[key]; },
        clear: () => { window.name = {}; },
        length: Object.keys(window.name || {}).length,
        key: (index) => Object.keys(window.name || {})[index]
      };
    }
  }
};
```

### 2. 性能优化配置
```typescript
// src/config/performance.ts
export const PerformanceConfig = {
  // 根据设备性能调整配置
  getOptimalConfig() {
    const navigator = window.navigator;
    const memory = (navigator as any).deviceMemory || 4;
    const cores = navigator.hardwareConcurrency || 4;

    if (memory < 4 || cores < 4) {
      // 低配置设备优化
      return {
        chartAnimations: false,
        realtimeInterval: 5000,
        maxDataPoints: 100,
        enableVirtualization: true,
      };
    }

    return {
      chartAnimations: true,
      realtimeInterval: 1000,
      maxDataPoints: 500,
      enableVirtualization: false,
    };
  }
};
```

## 测试策略

### 1. 组件测试
```typescript
// src/components/__tests__/Dashboard.test.tsx
import { render, screen, waitFor } from '@testing-library/react';
import { Provider } from 'react-redux';
import { store } from '../store';
import { Dashboard } from '../pages/Dashboard';

describe('Dashboard', () => {
  it('should render dashboard with stats', async () => {
    render(
      <Provider store={store}>
        <Dashboard />
      </Provider>
    );

    await waitFor(() => {
      expect(screen.getByText('在线传感器')).toBeInTheDocument();
      expect(screen.getByText('数据质量')).toBeInTheDocument();
    });
  });

  it('should update realtime data', async () => {
    // WebSocket连接测试
    // 实时数据更新测试
  });
});
```

### 2. 端到端测试
```typescript
// e2e/dashboard.spec.ts
import { test, expect } from '@playwright/test';

test('完整用户流程测试', async ({ page }) => {
  // 登录
  await page.goto('/login');
  await page.fill('[data-testid=username]', 'admin');
  await page.fill('[data-testid=password]', 'password');
  await page.click('[data-testid=login-button]');

  // 进入仪表板
  await expect(page).toHaveURL('/dashboard');
  await expect(page.locator('[data-testid=stats-row]')).toBeVisible();

  // 检查实时数据
  await page.goto('/realtime');
  await expect(page.locator('[data-testid=sensor-grid]')).toBeVisible();

  // 数据分析
  await page.goto('/analysis');
  await page.selectOption('[data-testid=analysis-type]', 'trend');
  await page.click('[data-testid=start-analysis]');
  await expect(page.locator('[data-testid=analysis-chart]')).toBeVisible();
});
```

## 实施计划

### 第1-2天: 基础架构搭建
- [ ] 项目脚手架和Doubao设计系统集成
- [ ] 状态管理和API层实现
- [ ] 路由和布局组件

### 第3-4天: 核心页面开发
- [ ] 仪表板页面实现
- [ ] 实时监控页面
- [ ] 数据管理页面

### 第5-6天: 分析功能实现
- [ ] 数据分析页面
- [ ] 预测功能集成
- [ ] 报告生成功能

### 第7天: 移动端适配
- [ ] 响应式布局实现
- [ ] 移动端组件优化
- [ ] 触摸交互适配

### 第8天: 国产化和优化
- [ ] 信创环境兼容性测试
- [ ] 性能优化和调试
- [ ] 用户体验完善

## 交付物
- [ ] 完整前端应用
- [ ] 组件库和设计规范
- [ ] 用户操作手册
- [ ] 部署和维护文档

## 验收标准
- 界面响应时间小于2秒
- 移动端兼容性良好
- 支持信创环境运行
- 用户体验评分达到90%以上